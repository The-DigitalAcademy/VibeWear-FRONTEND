<div class="container mt-4" *ngIf="{ 
  items: cartItems$ | async, 
  total: totalPrice$ | async 
} as data">
  
  <div class="card shadow-sm p-3">
    <div class="row">
      <div class="col-md-8 cart">
        <div class="title mb-3">
          <div class="row">
            <div class="col">
              <h4><b>Shopping Cart</b></h4>
            </div>
            <div class="col align-self-center text-end text-muted ">
              <button
                class="btn btn-outline-danger btn-sm"
                (click)="clearCart()"
                [disabled]="!data.items || data.items.length === 0"
              >
                Clear Cart
              </button>
            </div>  
          </div>
        </div>

        <div *ngIf="!data.items || data.items.length === 0" class="alert alert-info">
          Your cart is empty.
          <a routerLink="/products" class="alert-link">Continue shopping</a>
        </div>

        <div *ngIf="data.items && data.items.length > 0">
          <div class="row border-top border-bottom py-2" *ngFor="let item of data.items">
            <div class="row main align-items-center">
              <div class="col-2">
                <img [src]="item.image" [alt]="item.title" class="img-fluid rounded" style="object-fit: contain; height: 80px" />
              </div>

              <div class="col">
                <div class="row text-muted">{{ item.title }}</div>
                <div class="row small text-secondary"> Price: R{{ item.price | number : '1.2-2' }} </div>
              </div>

              <div class="col text-center">
                <div class="d-flex justify-content-center align-items-center">
                  <button class="btn btn-link px-2" (click)="updateQuantity(item, item.quantity - 1)">âˆ’</button>
                  <span class="border px-2">{{ item.quantity }}</span>
                  <button class="btn btn-link px-2" (click)="updateQuantity(item, item.quantity + 1)">+</button>
                </div>
              </div>

              <div class="col text-end">
                R{{ item.price * item.quantity | number : '1.2-2' }}
                <span class="text-danger ms-2" style="cursor: pointer" (click)="removeItem(item.id)">&times;</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="col-md-4 summary bg-light p-4 rounded">
        <h5><b>Summary</b></h5>
        <hr />

        <div class="row">
          <div class="col">ITEMS {{ data.items?.length || 0 }}</div>
          <div class="col text-end">R{{ data.total | number: '1.2-2' }}</div>
        </div>

        <div class="row mt-3 pt-3 border-top border-secondary-subtle">
          <div class="col"><strong>GRAND TOTAL</strong></div>
          <div class="col text-end">
            <strong>R{{ grandTotal(data.total || 0) | number: '1.2-2' }}</strong>
          </div>
        </div>

       <button
  class="btn btn-primary w-100 mt-3"
  data-bs-toggle="modal"
  data-bs-target="#checkoutModal"
  [disabled]="!(cartItems$ | async)?.length"
  (click)="checkout()"
>
  CHECKOUT
</button>

      </div>
    </div>
  </div>
</div>


<!-- Checkout Modal -->
<div
  class="modal fade"
  id="checkoutModal"
  tabindex="-1"
  aria-labelledby="checkoutModalLabel"
  aria-hidden="true"
>
  <app-check-out-pop-up></app-check-out-pop-up>
</div>